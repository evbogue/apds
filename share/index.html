<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Share on ANProto Demo</title>
    <style>
      body { margin: 0; font-family: system-ui, sans-serif; }
      main { padding: 24px; }
      label { display: grid; gap: 6px; margin: 12px 0; }
      textarea { width: min(640px, 100%); min-height: 140px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; }
      .row { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
      .note { color: #555; max-width: 640px; }
    </style>
  </head>
  <body>
    <main>
      <h1>Share on ANProto</h1>
      <p class="note">
        This demo shows the new Wiredove share redirect flow. The button opens
        <code>https://wiredove.net/#share=&lt;json&gt;</code> in a new tab and pre-fills the composer.
      </p>

      <label>
        Custom share payload (JSON)
        <textarea id="sharePayload">{
  "text": "Check this out",
  "title": "Example Page",
  "url": "https://example.com/page"
}</textarea>
      </label>

      <div class="row">
        <button class="wiredove-share" id="wiredoveShareButton" title="Share with ANProto">
          Share
          <img alt="Wiredove logo" />
        </button>
        <button class="wiredove-share-icon" id="wiredoveIconButton" aria-label="Share on ANProto" title="Share with ANProto">
          <img alt="Wiredove logo" />
        </button>
      </div>

      <div class="examples">
        <h2>Example: Wiredove Share Button</h2>
        <pre><code>&lt;button class="wiredove-share" id="wiredoveShareButton" title="Share with ANProto"&gt;
  Share
  &lt;img alt="Wiredove logo" /&gt;
&lt;/button&gt;
&lt;script type="module"&gt;
  const { attachWiredoveShareButton } = await import('__BASE_URL__share-button.js')

  attachWiredoveShareButton(
    document.querySelector('#wiredoveShareButton'),
    {
      text: 'Check this out',
      title: document.title,
      url: window.location.href
    }
  )
&lt;/script&gt;</code></pre>

        <h2>Example: Icon-Only Button</h2>
        <pre><code>&lt;button class="wiredove-share-icon" id="wiredoveIconButton" aria-label="Share on ANProto" title="Share with ANProto"&gt;
  &lt;img alt="Wiredove logo" /&gt;
&lt;/button&gt;
&lt;script type="module"&gt;
  const { attachWiredoveIconShareButton } = await import('__BASE_URL__share-button.js')

  attachWiredoveIconShareButton(
    document.querySelector('#wiredoveIconButton'),
    {
      text: 'Check this out',
      title: document.title,
      url: window.location.href
    }
  )
&lt;/script&gt;</code></pre>
      </div>
    </main>

    <script type="module">
      import { attachWiredoveShareButton, attachWiredoveIconShareButton } from '/share/share-button.js'

      const payloadInput = document.querySelector('#sharePayload')
      const buildPayload = () => {
        try {
          return JSON.parse(payloadInput.value)
        } catch (err) {
          return { text: payloadInput.value }
        }
      }

      attachWiredoveShareButton(
        document.querySelector('#wiredoveShareButton'),
        buildPayload
      )

      attachWiredoveIconShareButton(
        document.querySelector('#wiredoveIconButton'),
        buildPayload
      )

      const base = new URL('/share/', window.location.origin).href
      document.querySelectorAll('pre code').forEach((code) => {
        code.textContent = code.textContent.replaceAll('__BASE_URL__', base)
      })
    </script>
  </body>
</html>
